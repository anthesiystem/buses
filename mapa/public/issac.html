<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registros</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      /* Paleta sobria */
      --brand: #7b1e2b;          /* vino/burdeos */
      --brand-600: #8e2433;
      --brand-700: #661822;
      --brand-rgb: 123,30,43;
      --ink: #1f2937;            /* gris muy oscuro para texto */
      --muted: #6b7280;          /* gris medio para secundarios */
      --row-hover: rgba(var(--brand-rgb), .04);
      --row-selected: rgba(var(--brand-rgb), .08);
      --header-bg: #ffffff;
      --header-border: #e5e7eb;
      --table-border: #e5e7eb;
      --badge-bg: #f3f4f6;
    }

    body{ color: var(--ink); background: #fafafa; }

    .page-title{
      font-weight: 700; letter-spacing: .2px;
    }

    /* Botones marca */
    .btn-brand{
      --bs-btn-bg: var(--brand);
      --bs-btn-border-color: var(--brand);
      --bs-btn-hover-bg: var(--brand-600);
      --bs-btn-hover-border-color: var(--brand-600);
      --bs-btn-active-bg: var(--brand-700);
      --bs-btn-active-border-color: var(--brand-700);
      --bs-btn-color: #fff;
    }
    .btn-outline-brand{
      --bs-btn-color: var(--brand);
      --bs-btn-border-color: var(--brand);
      --bs-btn-hover-bg: var(--brand);
      --bs-btn-hover-border-color: var(--brand);
      --bs-btn-hover-color: #fff;
    }

    /* Contenedor con barra de herramientas */
    .toolbar{
      background:#fff; border:1px solid var(--header-border);
      border-radius: 14px; padding: 12px 14px; box-shadow: 0 2px 10px rgba(0,0,0,.03);
    }

    /* Tabla */
    .table-card{
      background:#fff; border:1px solid var(--table-border);
      border-radius: 14px; overflow: hidden; box-shadow: 0 6px 24px rgba(0,0,0,.04);
    }
    .table-responsive{
      max-height: 70vh;
    }
    .table-brand thead th{
      position: sticky; top: 0; z-index: 5;
      background: var(--header-bg);
      border-bottom: 1px solid var(--header-border);
      color: var(--muted); font-weight: 700; text-transform: uppercase;
      font-size: .78rem; letter-spacing: .5px;
    }
    .table-brand tbody td{
      vertical-align: middle; border-color: var(--table-border);
    }
    .table-brand tbody tr:hover{ background: var(--row-hover); }
    .table-brand tbody tr.selected{
      background: var(--row-selected);
      box-shadow: inset 4px 0 0 var(--brand);
    }
    .table-brand .progress{
      height: 8px; background: #efe7e9;
    }
    .progress-bar.brand{ background: var(--brand); }

    /* Badges de estado, discretos */
    .badge-soft{
      background: var(--badge-bg); color: var(--ink);
      border: 1px solid #e5e7eb; font-weight: 600;
    }
    .badge-implementado{ border-color:#d1fae5; background:#f0fdf4; color:#065f46;}
    .badge-pruebas{ border-color:#fde68a; background:#fffbeb; color:#92400e;}

    /* Columna Acciones: compacta en desktop */
    .actions .btn{ padding: .25rem .5rem; }

    /* Responsive: oculta columnas menos críticas en pantallas chicas */
    @media (max-width: 768px){
      .col-sm-hide{ display:none; }
      .actions .btn .text{ display:none; } /* sólo iconos en sm */
    }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="page-title m-0">Registros</h1>
      <button class="btn btn-brand"><i class="bi bi-plus-lg me-2"></i>Agregar</button>
    </div>

    <!-- Barra de herramientas -->
    <div class="toolbar mb-3">
      <div class="row g-2 align-items-center">
        <div class="col-12 col-md-6">
          <div class="input-group">
            <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
            <input id="q" type="search" class="form-control" placeholder="Buscar en todas las columnas…">
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="clickSelect" checked>
            <label class="form-check-label" for="clickSelect">Seleccionar fila con clic</label>
          </div>
        </div>
        <div class="col-6 col-md-3 text-md-end">
          <span id="selCount" class="text-muted small">0 seleccionadas</span>
        </div>
      </div>
    </div>

    <!-- Tabla -->
    <div class="table-card">
      <div class="table-responsive">
        <table id="tabla" class="table table-hover table-brand align-middle m-0">
          <thead>
            <tr>
              <th style="width:42px">
                <input class="form-check-input" type="checkbox" id="checkAll" title="Seleccionar todo">
              </th>
              <th data-sort="num">ID</th>
              <th data-sort="text">Entidad</th>
              <th class="col-sm-hide" data-sort="text">Dependencia</th>
              <th data-sort="text">Bus</th>
              <th data-sort="text">Engine</th>
              <th class="col-sm-hide" data-sort="text">Versión</th>
              <th data-sort="text">Estado</th>
              <th class="col-sm-hide" data-sort="date">Inicio</th>
              <th class="col-sm-hide" data-sort="date">Migración</th>
              <th data-sort="num">Avance</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <!-- Ejemplos; sustituye por tu render del backend -->
            <tr>
              <td><input class="row-check form-check-input" type="checkbox" /></td>
              <td>1</td>
              <td>AGUASCALIENTES</td>
              <td class="col-sm-hide">PGJ</td>
              <td>RNL (LICENCIAS)aa</td>
              <td>SQL SERVER</td>
              <td class="col-sm-hide">6.1.3</td>
              <td><span class="badge badge-soft badge-implementado">IMPLEMENTADO</span></td>
              <td class="col-sm-hide">2025-07-27</td>
              <td class="col-sm-hide">2025-08-04</td>
              <td>
                <div class="d-flex align-items-center gap-2">
                  <div class="progress flex-fill">
                    <div class="progress-bar brand" role="progressbar" style="width:100%"></div>
                  </div>
                  <small class="text-muted">100%</small>
                </div>
              </td>
              <td class="actions text-end">
                <div class="btn-group">
                  <button class="btn btn-outline-brand btn-sm" data-bs-toggle="tooltip" data-bs-title="Editar">
                    <i class="bi bi-pencil"></i><span class="text ms-1">Editar</span>
                  </button>
                  <button class="btn btn-outline-danger btn-sm" data-bs-toggle="tooltip" data-bs-title="Eliminar">
                    <i class="bi bi-trash"></i><span class="text ms-1">Eliminar</span>
                  </button>
                  <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#comentariosModal">
                    <i class="bi bi-chat-left-text"></i><span class="text ms-1">Comentarios</span>
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td><input class="row-check form-check-input" type="checkbox" /></td>
              <td>2</td>
              <td>AGUASCALIENTES</td>
              <td class="col-sm-hide">PGJ</td>
              <td>RNL (LICENCIAS)aa</td>
              <td>SQL SERVER</td>
              <td class="col-sm-hide">6.1.3</td>
              <td><span class="badge badge-soft badge-implementado">IMPLEMENTADO</span></td>
              <td class="col-sm-hide">2025-08-01</td>
              <td class="col-sm-hide">2025-08-01</td>
              <td>
                <div class="d-flex align-items-center gap-2">
                  <div class="progress flex-fill"><div class="progress-bar brand" style="width:100%"></div></div>
                  <small class="text-muted">100%</small>
                </div>
              </td>
              <td class="actions text-end">
                <div class="btn-group">
                  <button class="btn btn-outline-brand btn-sm" data-bs-toggle="tooltip" data-bs-title="Editar">
                    <i class="bi bi-pencil"></i><span class="text ms-1">Editar</span>
                  </button>
                  <button class="btn btn-outline-danger btn-sm" data-bs-toggle="tooltip" data-bs-title="Eliminar">
                    <i class="bi bi-trash"></i><span class="text ms-1">Eliminar</span>
                  </button>
                  <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#comentariosModal">
                    <i class="bi bi-chat-left-text"></i><span class="text ms-1">Comentarios</span>
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td><input class="row-check form-check-input" type="checkbox" /></td>
              <td>37</td>
              <td>BAJA CALIFORNIA</td>
              <td class="col-sm-hide">PGJ</td>
              <td>VRyR (VEHÍCULOS)</td>
              <td>ORACLE</td>
              <td class="col-sm-hide">7.0.4</td>
              <td><span class="badge badge-soft badge-pruebas">PRUEBAS</span></td>
              <td class="col-sm-hide">2024-01-16</td>
              <td class="col-sm-hide">2024-01-16</td>
              <td>
                <div class="d-flex align-items-center gap-2">
                  <div class="progress flex-fill"><div class="progress-bar brand" style="width:60%"></div></div>
                  <small class="text-muted">60%</small>
                </div>
              </td>
              <td class="actions text-end">
                <div class="btn-group">
                  <button class="btn btn-outline-brand btn-sm" data-bs-toggle="tooltip" data-bs-title="Editar">
                    <i class="bi bi-pencil"></i><span class="text ms-1">Editar</span>
                  </button>
                  <button class="btn btn-outline-danger btn-sm" data-bs-toggle="tooltip" data-bs-title="Eliminar">
                    <i class="bi bi-trash"></i><span class="text ms-1">Eliminar</span>
                  </button>
                  <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#comentariosModal">
                    <i class="bi bi-chat-left-text"></i><span class="text ms-1">Comentarios</span>
                  </button>
                </div>
              </td>
            </tr>
            <!-- ...más filas -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal Comentarios -->
  <div class="modal fade" id="comentariosModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Comentarios</h5>
          <button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <p class="text-muted">Aquí puedes cargar/guardar comentarios del registro seleccionado.</p>
          <textarea class="form-control" rows="6" placeholder="Escribe comentarios…"></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button class="btn btn-brand">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Tooltips
    document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el=>new bootstrap.Tooltip(el));

    const q = document.getElementById('q');
    const table = document.getElementById('tabla');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.rows);
    const selCount = document.getElementById('selCount');
    const clickSelect = document.getElementById('clickSelect');
    const checkAll = document.getElementById('checkAll');

    // Búsqueda global
    q.addEventListener('input', () => {
      const term = q.value.trim().toLowerCase();
      rows.forEach(r => {
        const visible = r.innerText.toLowerCase().includes(term);
        r.style.display = visible ? '' : 'none';
      });
    });

    // Selección por clic de fila
    tbody.addEventListener('click', (e) => {
      if (!clickSelect.checked) return;
      // Evita que los clics en controles internos activen selección doble
      if (e.target.closest('button, .form-check-input, a, [data-bs-toggle]')) return;
      const tr = e.target.closest('tr');
      if (!tr) return;
      const cb = tr.querySelector('.row-check');
      cb.checked = !cb.checked;
      toggleRow(tr, cb.checked);
      refreshCount();
    });

    // Selección con check individual
    tbody.querySelectorAll('.row-check').forEach(cb => {
      cb.addEventListener('change', (e)=>{
        const tr = e.target.closest('tr');
        toggleRow(tr, e.target.checked);
        refreshCount();
      });
    });

    // Seleccionar todo
    checkAll.addEventListener('change', ()=>{
      const checked = checkAll.checked;
      tbody.querySelectorAll('.row-check').forEach(cb=>{
        cb.checked = checked;
        toggleRow(cb.closest('tr'), checked);
      });
      refreshCount();
    });

    function toggleRow(tr, isSelected){
      tr.classList.toggle('selected', isSelected);
    }
    function refreshCount(){
      const n = tbody.querySelectorAll('.row-check:checked').length;
      selCount.textContent = ${n} seleccionada${n===1?'':'s'};
      if(n !== rows.length){ checkAll.checked = false; }
      if(n === rows.length && rows.length>0){ checkAll.checked = true; }
    }

    // Ordenamiento por columna (texto, numérico o fecha ISO yyyy-mm-dd)
    const getCellValue = (tr, idx) => tr.children[idx].innerText.trim();
    const parseVal = (val, type) => {
      if(type==='num'){ const n = Number(val.replace(/\D+/g,'')); return isNaN(n)?Number.NEGATIVE_INFINITY:n; }
      if(type==='date'){ const t = Date.parse(val); return isNaN(t)?-Infinity:t; }
      return val.toLowerCase();
    };
    table.querySelectorAll('thead th[data-sort]').forEach((th, idx)=>{
      let asc = true;
      th.style.cursor = 'pointer';
      th.addEventListener('click', ()=>{
        const type = th.getAttribute('data-sort');
        rows.sort((a,b)=>{
          const A = parseVal(getCellValue(a, idx), type);
          const B = parseVal(getCellValue(b, idx), type);
          return asc ? (A>B?1:A<B?-1:0) : (A<B?1:A>B?-1:0);
        });
        asc = !asc;
        rows.forEach(r=>tbody.appendChild(r));
        // Indicador visual simple
        table.querySelectorAll('thead th').forEach(x=>x.classList.remove('text-decoration-underline'));
        th.classList.add('text-decoration-underline');
      });
    });
  </script>
</body>
</html>